<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¸è¿å¤§è½¬ç›˜</title>
    <style>
        :root {
            --wheel-size: 320px;
            --color-1: #FF5252; /* 3å…ƒ - çº¢ */
            --color-2: #7C4DFF; /* æœªä¸­å¥– - ç´« */
            --color-3: #448AFF; /* 0.3å…ƒ - è“ */
            --color-4: #FFC107; /* å†æ¥ä¸€æ¬¡ - é»„ */
            --color-5: #00BCD4; /* 0.1å…ƒ - é’ */
            --color-6: #8BC34A; /* å†æ¥ä¸€æ¬¡ - ç»¿ */
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        h1 { color: #333; margin-bottom: 10px; }

        /* ä»ªè¡¨ç›˜ */
        .dashboard {
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .highlight { color: #FF5252; font-size: 1.3rem; }

        /* è½¬ç›˜å®¹å™¨ */
        .wheel-container {
            position: relative;
            width: var(--wheel-size);
            height: var(--wheel-size);
            border: 10px solid white;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
        }

        /* è½¬ç›˜ä¸»ä½“ */
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            /* 6ä¸ªæ‰‡åŒºï¼Œæ¯ä¸ª60åº¦ */
            background: conic-gradient(
                var(--color-1) 0deg 60deg,
                var(--color-2) 60deg 120deg,
                var(--color-3) 120deg 180deg,
                var(--color-4) 180deg 240deg,
                var(--color-5) 240deg 300deg,
                var(--color-6) 300deg 360deg
            );
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            transform: rotate(0deg);
        }

        /* æ‰‡åŒºæ–‡å­— */
        .label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0 0;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            width: 50%; /* ä»ä¸­å¿ƒåˆ°è¾¹ç¼˜ */
            height: 1px;
            text-align: center;
            line-height: 0;
        }
        
        /* æ–‡å­—ä½ç½®ä¿®æ­£ï¼šæ—‹è½¬åˆ°æ‰‡åŒºä¸­å¿ƒï¼Œå¹¶å¤–æ¨ */
        .label span {
            display: inline-block;
            transform: rotate(90deg) translateY(-20px); /* æ–‡å­—æœ¬èº«çš„æ–¹å‘è°ƒæ•´ */
            position: absolute;
            right: 40px; /* è·ç¦»åœ†å¿ƒçš„è·ç¦»æ§åˆ¶ */
        }

        .l1 { transform: rotate(30deg); }
        .l2 { transform: rotate(90deg); }
        .l3 { transform: rotate(150deg); }
        .l4 { transform: rotate(210deg); }
        .l5 { transform: rotate(270deg); }
        .l6 { transform: rotate(330deg); }

        /* ä¸­å¿ƒæŒ‡é’ˆ/æŒ‰é’®åŒºåŸŸ */
        .center-circle {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #FF9E80, #FF6E40);
            border: 4px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 10;
            user-select: none;
        }
        
        /* é¡¶éƒ¨æŒ‡é’ˆ */
        .pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #333;
            z-index: 20;
        }

        .btn-disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            animation: popIn 0.3s ease;
            width: 80%;
            max-width: 300px;
        }
        .modal h2 { margin-top: 0; color: #FF5252; }
        .modal p { font-size: 1.2rem; margin: 20px 0; }
        .close-btn {
            background: #333;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }

        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

    <h1>è¶…çº§ç¦åˆ©è½¬ç›˜</h1>

    <div class="dashboard">
        <div>å‰©ä½™æ¬¡æ•°: <span id="count" class="highlight">5</span></div>
        <div>æ€»é‡‘é¢: <span id="money" class="highlight">0</span> å…ƒ</div>
    </div>

    <div class="wheel-container">
        <div class="pointer"></div>
        <div class="wheel" id="wheel">
            <div class="label l1"><span>3å…ƒ</span></div>
            <div class="label l2"><span>æœªä¸­å¥–</span></div>
            <div class="label l3"><span>0.3å…ƒ</span></div>
            <div class="label l4"><span>å†æ¥ä¸€æ¬¡</span></div>
            <div class="label l5"><span>0.1å…ƒ</span></div>
            <div class="label l6"><span>å†æ¥ä¸€æ¬¡</span></div>
        </div>
        <div class="center-circle" id="spinBtn" onclick="spin()">
            å¼€å§‹
        </div>
    </div>

    <div class="modal-overlay" id="resultModal">
        <div class="modal">
            <h2>ğŸ‰ æ¸¸æˆç»“æŸ</h2>
            <p id="finalText"></p>
            <button class="close-btn" onclick="location.reload()">é‡ç½®æ¸¸æˆ</button>
        </div>
    </div>

    <script>
        // é…ç½®æ•°æ®
        const segments = [
            { name: "3å…ƒ", value: 3.0, type: "money" },       // index 0
            { name: "æœªä¸­å¥–", value: 0, type: "none" },        // index 1
            { name: "0.3å…ƒ", value: 0.3, type: "money" },     // index 2
            { name: "å†æ¥ä¸€æ¬¡", value: 0, type: "retry" },     // index 3
            { name: "0.1å…ƒ", value: 0.1, type: "money" },     // index 4
            { name: "å†æ¥ä¸€æ¬¡", value: 0, type: "retry" }      // index 5
        ];

        // ä¸¥æ ¼çš„æ‰§è¡Œé¡ºåº (å¯¹åº”ä¸Šé¢çš„ segments ç´¢å¼•)
        // é¡ºåº: 3å…ƒ -> æœªä¸­å¥– -> 0.3å…ƒ -> å†æ¥ä¸€æ¬¡ -> 0.1å…ƒ -> å†æ¥ä¸€æ¬¡
        const fixedSequence = [0, 1, 2, 3, 4, 5];

        let currentSpinCount = 5;
        let currentMoney = 0;
        let sequenceIndex = 0; // å½“å‰æ‰§è¡Œåˆ°ç¬¬å‡ æ­¥
        let isSpinning = false;
        let currentRotation = 0; // è®°å½•å½“å‰æ—‹è½¬è§’åº¦ï¼Œé˜²æ­¢åè½¬

        // DOM å…ƒç´ 
        const wheel = document.getElementById('wheel');
        const spinBtn = document.getElementById('spinBtn');
        const countDisplay = document.getElementById('count');
        const moneyDisplay = document.getElementById('money');
        const modal = document.getElementById('resultModal');
        const finalText = document.getElementById('finalText');

        function spin() {
            if (isSpinning) return;
            if (currentSpinCount <= 0) {
                alert("æ¬¡æ•°å·²ç”¨å®Œï¼");
                return;
            }
            
            // å¦‚æœåºåˆ—èµ°å®Œäº†ï¼Œå³ä½¿æ¬¡æ•°æ˜¾ç¤ºè¿˜æœ‰ï¼Œä¹Ÿç»“æŸï¼ˆé˜²æ­¢é€»è¾‘æº¢å‡ºï¼‰
            if (sequenceIndex >= fixedSequence.length) {
                showResult();
                return;
            }

            isSpinning = true;
            spinBtn.classList.add('btn-disabled');
            spinBtn.innerText = "æŠ½å¥–ä¸­";

            // 1. æ‰£é™¤æ¬¡æ•° (è§†è§‰ä¸Š)
            currentSpinCount--;
            countDisplay.innerText = currentSpinCount;

            // 2. è·å–æœ¬è½®æ—¢å®šç»“æœ
            const targetIndex = fixedSequence[sequenceIndex];
            const targetSegment = segments[targetIndex];

            // 3. è®¡ç®—æ—‹è½¬è§’åº¦
            // æ¯ä¸ªæ‰‡åŒº60åº¦ã€‚
            // è¿™é‡Œçš„é€»è¾‘æ˜¯ï¼šæŒ‡é’ˆåœ¨ä¸Šæ–¹(0åº¦/360åº¦)ã€‚
            // å¦‚æœç›®æ ‡æ˜¯ Index 0 (0-60åº¦)ï¼Œè¦è®©å®ƒåœåœ¨ä¸Šæ–¹ï¼Œè½¬ç›˜éœ€è¦æ—‹è½¬ï¼š
            // 360 - (æ‰‡åŒºä¸­å¿ƒè§’åº¦)ã€‚
            // Index 0 ä¸­å¿ƒæ˜¯ 30åº¦ -> è½¬ 330åº¦ã€‚
            // Index 1 ä¸­å¿ƒæ˜¯ 90åº¦ -> è½¬ 270åº¦ã€‚
            
            const segmentAngle = 60;
            const targetCenterAngle = (targetIndex * segmentAngle) + (segmentAngle / 2); 
            
            // åŸºç¡€æ—‹è½¬åœˆæ•° (è‡³å°‘è½¬5åœˆï¼Œ1800åº¦)
            const baseSpins = 360 * 5; 
            
            // è®¡ç®—æœ€ç»ˆè§’åº¦ï¼šæˆ‘ä»¬è¦åˆ°è¾¾çš„è§’åº¦æ˜¯ (360 - targetCenterAngle)
            // ä¸ºäº†ä¿æŒè¿ç»­é¡ºæ—¶é’ˆï¼Œæˆ‘ä»¬éœ€è¦åŸºäºå½“å‰çš„ currentRotation ç´¯åŠ 
            // è®¡ç®— currentRotation å½“å‰åœ¨ 360 ä¸­çš„ä½™æ•°ä½ç½®
            const currentMod = currentRotation % 360;
            
            // ç›®æ ‡ç›¸å¯¹ä½ç½®
            const targetStop = 360 - targetCenterAngle;
            
            // è®¡ç®—å·®å€¼
            let adjust = targetStop - currentMod;
            if (adjust < 0) adjust += 360; // ä¿è¯æ­£å‘æ—‹è½¬

            const finalRotate = currentRotation + baseSpins + adjust;

            // 4. æ‰§è¡ŒåŠ¨ç”»
            wheel.style.transform = `rotate(${finalRotate}deg)`;
            currentRotation = finalRotate; // æ›´æ–°çŠ¶æ€

            // 5. åŠ¨ç”»ç»“æŸåå¤„ç†é€»è¾‘ (4ç§’å)
            setTimeout(() => {
                handleResult(targetSegment);
            }, 4000);
        }

        function handleResult(segment) {
            isSpinning = false;
            spinBtn.classList.remove('btn-disabled');
            spinBtn.innerText = "å¼€å§‹";

            // é€»è¾‘å¤„ç†
            if (segment.type === 'money') {
                currentMoney += segment.value;
                // è§£å†³æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ (0.1 + 0.2 = 0.3000004)
                currentMoney = Math.round(currentMoney * 100) / 100;
            } else if (segment.type === 'retry') {
                currentSpinCount++;
                countDisplay.innerText = currentSpinCount;
                // å¯ä»¥åœ¨è¿™é‡ŒåŠ ä¸ªå°æç¤º "è·å¾—é¢å¤–ä¸€æ¬¡æœºä¼š!"
            }

            // æ›´æ–° UI
            moneyDisplay.innerText = currentMoney;

            // ç§»åŠ¨åˆ°åºåˆ—ä¸‹ä¸€æ­¥
            sequenceIndex++;

            // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰æ—¢å®šå‰§æœ¬éƒ½èµ°å®Œäº†
            // æ³¨æ„ï¼šè™½ç„¶æœ€åä¸€æ¬¡æ˜¯â€œå†æ¥ä¸€æ¬¡â€ï¼Œå¯¼è‡´ currentSpinCount = 1
            // ä½†æ ¹æ®ä½ çš„è¦æ±‚â€œåªèµ°ä¸€è½®â€ï¼Œä¸”åºåˆ—å·²ç»ç”¨å…‰ï¼Œæ¸¸æˆåº”ç»“æŸã€‚
            if (sequenceIndex >= fixedSequence.length) {
                setTimeout(showResult, 500);
            } else if (currentSpinCount === 0) {
                // åŒé‡ä¿é™©ï¼šå¦‚æœåºåˆ—æ²¡èµ°å®Œä½†æ¬¡æ•°æ²¡äº†ï¼ˆç†è®ºä¸Šä½ çš„å‰§æœ¬ä¸ä¼šè§¦å‘è¿™ä¸ªï¼‰
                setTimeout(showResult, 500);
            }
        }

        function showResult() {
            finalText.innerHTML = `æ­å–œï¼<br>æ€»å…±è·å¾—é‡‘é¢ï¼š<b style="font-size:24px; color:#FF5252">${currentMoney}å…ƒ</b>`;
            modal.style.display = 'flex';
            spinBtn.classList.add('btn-disabled');
            spinBtn.onclick = null; // ç¦ç”¨ç‚¹å‡»
        }
    </script>
</body>
</html>
